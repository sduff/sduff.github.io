<!DOCTYPE html>
<html lang="en">

<head>
   <link rel="icon" href="/favicon.png" />

   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">

   <link rel="stylesheet" href="https://fonts.xz.style/serve/inter.css">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.2/new.min.css">

   <!-- highlight.js code formatter -->
   <link rel="stylesheet"
      href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/nord.min.css">
   <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
   <!-- remove styled padding on pre in code -->
   <style>
      pre { padding: 0; }
   </style>

   <title></title>
   <meta name="description" content="">
   <meta name="author" content="Simon Duff" />
</head>
<body>
<header>
<h1>Simon Duff</h1>
   <nav>
      <a href="https://newcss.net">Home</a> /
      <a href="https://newcss.net/usage/">Usage</a> /
      <a href="https://newcss.net/usage/elements/">Elements</a> /
      <a href="https://newcss.net/themes/">Themes</a> /
      <a href="https://github.com/xz/new.css">GitHub</a> / 
      <a href="https://discord.gg/hhuuC4w">Discord</a>
   </nav>
</header>
<p>title: Hammerspoon Configuration
date: 2017-10-30
tags: [dotfiles]
published: true
layout: default</p>
<hr />
<h1>Hammerspoon</h1>
<p><a href="http://hammerspoon.org">Hammerspoon</a> is a OS X utility that provides a high
level of customisation to control the working environment. Using it, one can
specify configuration where events such as mouse clicks and drags, and keyboard
shortcuts can be used to trigger scripts or alter the environment as one
prefers.</p>
<h3>Caps Lock</h3>
<p>For many, the caps lock key is one of the most useless keys on modern
keyboards; rarely used, it is one of the largest buttons on a keyboard with
little useful functionality.</p>
<p>On the other hand, the new Macbook Pros have eliminated the escape key, one of
the most important keys for a <a href="http://www.vim.org">vim</a> user, replacing it with
the touch bar. While the escape &quot;key&quot; would still be present on the touch bar,
there is something reassuring about pressing a physical escape button.</p>
<p>An ideal solution to this is to replace the functionality of the caps lock key
with the escape key. Rather than trying to hit the missing escape key, it is
possible to map the escape key to the caps lock key, allowing for less hand
movement, as well as a experiencing the tactile feedback of an actual key,
rather than the touch bar.</p>
<p>Mapping the caps lock key to escape is fairly easy in OS X. Under System
Preferences, Keyboard, Modifier Keys, the option to use Escape key as the
action to perform when the caps lock key is pressed.</p>
<p><img src="/img/osx_keyboard_modifiers.png" alt="OSX Keyboard Modifiers" title="OSX Keyboard Modifiers" /></p>
<p>Hammerspoon and
<a href="https://github.com/tekezo/Karabiner-Elements">Karabiner-Elements</a> take this to
a whole new level however, by allowing the caps lock key to function as an
escape key when pressed alone, <strong>and</strong> also acting as a &quot;hyper&quot; key when
pressed in conjunction with other keys. This &quot;hyper&quot; key opens up so many more
possibilities, for having global or application specific function keys,
especially when combined with Hammerspoon.</p>
<h2>Karabiner-Elements</h2>
<p>The first element (pun intended) in this setup is the configuration for
Karabiner-Elements. The following code JSON should be saved in a file in
<code>~/.config/karabiner/karabiner.json</code>. This config remaps the caps lock key to
send the escape key when pressed alone, while sending the command, control and
option keys when pressed in conjunction with other keys.</p>
<pre><code class="language-json">{
    &quot;global&quot;: {
        &quot;check_for_updates_on_startup&quot;: true,
        &quot;show_in_menu_bar&quot;: true,
        &quot;show_profile_name_in_menu_bar&quot;: false
    },
    &quot;profiles&quot;: [
        {
            &quot;complex_modifications&quot;: {
                &quot;parameters&quot;: {
                    &quot;basic.to_if_alone_timeout_milliseconds&quot;: 1000
                },
                &quot;rules&quot;: [
                    {
                        &quot;description&quot;: &quot;Shift Capslock sends Shift-Hyper, or escape if by itself&quot;,
                        &quot;manipulators&quot;: [
                            {
                                &quot;from&quot;: {
                                    &quot;key_code&quot;: &quot;caps_lock&quot;,
                                    &quot;modifiers&quot;: {
                                        &quot;mandatory&quot;: [
                                            &quot;left_shift&quot;
                                        ]
                                    }
                                },
                                &quot;to&quot;: [
                                    {
                                        &quot;key_code&quot;: &quot;left_shift&quot;,
                                        &quot;modifiers&quot;: [
                                            &quot;left_command&quot;,
                                            &quot;left_control&quot;,
                                            &quot;left_option&quot;
                                        ]
                                    }
                                ],
                                &quot;to_if_alone&quot;: [
                                    {
                                        &quot;key_code&quot;: &quot;escape&quot;
                                    }
                                ],
                                &quot;type&quot;: &quot;basic&quot;
                            }
                        ]
                    },
                    {
                        &quot;description&quot;: &quot;Capslock sends Hyper, or escape if by itself&quot;,
                        &quot;manipulators&quot;: [
                            {
                                &quot;from&quot;: {
                                    &quot;key_code&quot;: &quot;caps_lock&quot;
                                },
                                &quot;to&quot;: [
                                    {
                                        &quot;key_code&quot;: &quot;left_command&quot;,
                                        &quot;modifiers&quot;: [
                                            &quot;left_control&quot;,
                                            &quot;left_option&quot;
                                        ]
                                    }
                                ],
                                &quot;to_if_alone&quot;: [
                                    {
                                        &quot;key_code&quot;: &quot;escape&quot;
                                    }
                                ],
                                &quot;type&quot;: &quot;basic&quot;
                            }
                        ]
                    }
                ]
            },
            &quot;devices&quot;: [],
            &quot;fn_function_keys&quot;: [
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f1&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;display_brightness_decrement&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f2&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;display_brightness_increment&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f3&quot;
                    },
                    &quot;to&quot;: {
                        &quot;key_code&quot;: &quot;mission_control&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f4&quot;
                    },
                    &quot;to&quot;: {
                        &quot;key_code&quot;: &quot;launchpad&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f5&quot;
                    },
                    &quot;to&quot;: {
                        &quot;key_code&quot;: &quot;illumination_decrement&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f6&quot;
                    },
                    &quot;to&quot;: {
                        &quot;key_code&quot;: &quot;illumination_increment&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f7&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;rewind&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f8&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;play_or_pause&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f9&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;fastforward&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f10&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;mute&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f11&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;volume_decrement&quot;
                    }
                },
                {
                    &quot;from&quot;: {
                        &quot;key_code&quot;: &quot;f12&quot;
                    },
                    &quot;to&quot;: {
                        &quot;consumer_key_code&quot;: &quot;volume_increment&quot;
                    }
                }
            ],
            &quot;name&quot;: &quot;Default profile&quot;,
            &quot;selected&quot;: true,
            &quot;simple_modifications&quot;: [],
            &quot;virtual_hid_keyboard&quot;: {
                &quot;caps_lock_delay_milliseconds&quot;: 0,
                &quot;keyboard_type&quot;: &quot;ansi&quot;
            }
        }
    ]
}
</code></pre>
<h2>Hammerspoon Configuration</h2>
<p>The following Hammerspoon configuration should be saved to <code>~/.hammerspoon/init.lua</code>.</p>
<p>It defines <code>hyper</code> as the combination of command, control and option being
pressed at the same time, which has been remapped to the caps lock key.
<code>shyper</code> is defined as the same combination, in addition with the shift key.</p>
<p>There are various utility functions defined, then the main <code>hyper</code>/<code>shyper</code> key
bindings are specified.</p>
<p>For now, there are simple terminal, firefox and finder window launching, as
well as a quick shortcut for putting the computer's display to sleep.</p>
<p>Hammerspoon is not only limited to launching commands triggered by keystrokes.
There is a section devoted to window layout, sending windows to various grid
locations. If you imagine a screen being split into 4 quadrants, there are
various key bindings (in association with the caps lock/hyper remapping) to
send windows to occupy various quadrants. This allows a focused window to be
quickly mapped to a region of the screen.</p>
<p>There is also a section devoted to using the mouse to control layout of
windows. By grabbing the title bar of a window and dragging to either the edge
or corner of the screen, the related window will be resized and positioned
appropriately.</p>
<p>Concluding the configuration, there are a few miscellaneous items and comments
for future plans :)</p>
<pre><code class="language-lua">--[ Defines ]-------------------------------------------------------------

hyper =  {&quot;⌘&quot;, &quot;⌥&quot;, &quot;⌃&quot;}	-- caps lock held down
shyper = {&quot;⌘&quot;, &quot;⌥&quot;, &quot;⇧&quot;, &quot;⌃&quot;}	-- caps lock held down, with shift
hs.window.animationDuration = 0


--[ Functions ]---------------------------------------------------------
function findOrLaunch(a)
    local app = hs.application.find(a)
    if not app then
    	hs.application.launchOrFocus(a)
    end
    return hs.application.find(a)
end

function fancyNotify(t,m)
     hs.notify.new({title=t, informativeText=m}):send():release()
end


--[ Bindings ]---------------------------------------------------------

-- hyper shortcuts
hs.fnutils.each({
    { key = &quot;a&quot;, func = function() 
      myTerm = findOrLaunch(&quot;iterm&quot;)
      myTerm:selectMenuItem({&quot;Shell&quot;,&quot;New Window&quot;}) 
      end
  },
  { key = &quot;q&quot;, func = function()
      ffox = hs.appfinder.appFromName(&quot;Firefox&quot;)
      ffox:selectMenuItem({&quot;File&quot;,&quot;New Window&quot;})
      ffox:activate()
      end
  },
  { key = &quot;z&quot;, func = function()
      finder = hs.appfinder.appFromName(&quot;Finder&quot;)
      finder:selectMenuItem({&quot;File&quot;,&quot;New Finder Window&quot;})
      finder:activate()
      end
  }
}, function(object) hs.hotkey.bind(hyper, object.key, object.func) end)

-- shyper shoutcuts
hs.fnutils.each({
  { key = &quot;space&quot;, func = function()
      os.execute(&quot;pmset displaysleepnow&quot;)
      end 
  }
}, function(object) hs.hotkey.bind(shyper, object.key, object.func) end)



--[ grid ]---------------------------------------------------------------------
-- home made grid system works with hammerspoon's grid

hs.grid.setGrid('2x2')
hs.grid.setMargins('0x0')

function moveWindow(x, y, w, h)
    local win = hs.window.focusedWindow()
    local f = win:frame()
    local screen = win:screen()
    local max = screen:frame()

    f.x = max.x + (max.w*x)
    f.y = max.y + (max.h*y)
    f.w = max.w*w
    f.h = max.h*h
    win:setFrame(f)
end

-- bind hotkeys to grid 
hs.hotkey.bind(hyper,&quot;y&quot;, function() moveWindow(0.0,0.0,0.5,0.5) end)
hs.hotkey.bind(hyper,&quot;u&quot;, function() moveWindow(0.0,0.0,1.0,0.5) end)
hs.hotkey.bind(hyper,&quot;i&quot;, function() moveWindow(0.5,0.0,0.5,0.5) end)
hs.hotkey.bind(hyper,&quot;h&quot;, function() moveWindow(0.0,0.0,0.5,1.0) end)
hs.hotkey.bind(hyper,&quot;j&quot;, function() moveWindow(0.0,0.0,1.0,1.0) end)
hs.hotkey.bind(hyper,&quot;k&quot;, function() moveWindow(0.5,0.0,0.5,1.0) end)
hs.hotkey.bind(hyper,&quot;n&quot;, function() moveWindow(0.0,0.5,0.5,0.5) end)
hs.hotkey.bind(hyper,&quot;m&quot;, function() moveWindow(0.0,0.5,1.0,0.5) end)
hs.hotkey.bind(hyper,&quot;,&quot;, function() moveWindow(0.5,0.5,0.5,0.5) end)

--[ window dragging ]----------------------------------------------------------
dragging_window = nil
click_event = hs.eventtap.new({hs.eventtap.event.types.leftMouseDragged}, function(e)
    if dragging_window == nil  then
    	-- check mouse is in titlebar
    	local m = hs.mouse.getAbsolutePosition()
    	local f = hs.window:focusedWindow():frame()
    	local screen = hs.window:focusedWindow():screen()
    	local max = screen:frame()
    	if m.x &gt; f.x and m.x &lt; (f.x + f.w) then
    		if m.y &gt; f.y and m.y &lt; (f.y + 21) then
    			dragging_window = hs.window.focusedWindow()
    			dragging_window_time = hs.timer.localTime()
    		end
    	end
    end
end)
unclick_event = hs.eventtap.new({hs.eventtap.event.types.leftMouseUp}, function(e)
    if dragging_window ~= nil then
    	local m = hs.mouse.getAbsolutePosition()
    	local f = hs.window:focusedWindow():frame()
    	local screen = hs.window:focusedWindow():screen()
    	local max = screen:frame()
    	if m.x &lt; 50 then
    		if m.y &lt; 200 then
    			moveWindow(0.0,0.0,0.5,0.5)
    		elseif m.y &gt; (max.h-200) then
    			moveWindow(0.0,0.5,0.5,0.5)
    		else
    			moveWindow(0.0,0.0,0.5,1.0)
    		end
    	elseif m.x &gt; (max.w-50) then
    		if m.y &lt; 200 then
    			moveWindow(0.5,0.0,0.5,0.5)
    		elseif m.y &gt; (max.h-200) then
    			moveWindow(0.5,0.5,0.5,0.5)
    		else
    			moveWindow(0.5,0.0,0.5,1.0)
    		end
    	elseif m.y &lt; 25 and m.x&gt;200 and m.x &lt; (max.w-200) then
    			moveWindow(0.0,0.0,1.0,1.0)
    	end
    end
    dragging_window = nil
end)
click_event:start()
unclick_event:start()


--[ hourly alarm ]----------------------------------------------------------
hs.timer.doAt(&quot;0:00&quot;,&quot;1h&quot;, function() hs.alert(&quot;Ding Dong&quot;) end)

--[ fan ]-------------------------------------------------------------------
--[[
    my mac has a very noisy fan, this just puts the CPU temperature and fan
    speeds in the title bar
]]--
local menu_bar = hs.menubar.new()
menu_bar:setTitle(&quot;¯\\_(ツ)_/¯&quot;)
hs.timer.doAt(&quot;0:00&quot;,&quot;1m&quot;, function() 
    local d = hs.execute(&quot;/Users/sduff/bin/osx-cpu-temp -f&quot;):gsub(&quot;[\r\n]&quot;,&quot;&quot;)
    menu_bar:setTitle(d)
end)

--[ hazel-lite ]------------------------------------------------------------
--[[
    Hazel-lite file system cleanup and management
    
    Ideas
    - Downloads/Desktop
    	- Tag files
    	- _Actions
    	- Delete old files, Archive files to monthly folders
    	- Move dmg to Trash, then open them
    	- Add mp3 files to iTunes (music directory)
    	- Drop folder that automatically zips and files away
    	- IFTTT download top photo from earthporn/unsplash to dropbox, and then sync dropbox to make wallpapers
    	- monitor a folder for images, then create a shrunk version, then move them to website git directory, then add them to the git build. remove the exif info as well, add copyright, etc... Needs Exiftool (https://www.sno.phy.queensu.ca/~phil/exiftool/) or Imagemagick's mogrify (https://stackoverflow.com/questions/229446/how-do-i-add-exif-data-to-an-image)
    	- Move Desktop files to Downloads
    	- Delete files older than 1 week
    	- Archive certain files to Evernote/Dropbox/etc...
    	- Save to Evernote drop-folder
    	- Move torrent files to VirtualMachine
    	- Sync ebooks in dropbox
    	- Regularly clear tmp folders
    	- Regularly clear Outlook tempfiles (/private/var/folders/y3/g8b0sww1685gtyvx20c7ghpxrdx1c3/T/com.microsoft.Outlook) (maybe symlink ~/Outlook to this folder for future versions)
    	- Delete files that were downloaded from localhost
    	- Archive downloaded software (app, iso, dmg, deb, exe, pkg, rpm)
    	- Move downloaded videos (mov, mp4, avi) to its own directory
    	- Move epub,mobi,pdf to an ebooks directory, well named (use mdls to extract pdf metadata, or pdfminer, https://github.com/euske/pdfminer)
    	- mdls - https://www.macissues.com/2014/05/12/how-to-look-up-file-metadata-in-os-x/
    	- Weekly empty of Trash

    Resources
    - https://github.com/scottcs/dot_hammerspoon/blob/master/.hammerspoon/modules/hazel.lua
    - https://www.reddit.com/r/apple/comments/1wlxtr/do_you_use_hazel_what_are_some_of_your_coolest/

    - http://getawesomeness.herokuapp.com/get/osx	
    - http://awesomeawesome.party/awesome-macOS


    Other efficiency
  - https://msol.io/blog/tech/work-more-efficiently-on-your-mac-for-developers/
  - http://stevelosh.com/blog/2012/10/a-modern-space-cadet/ (The Grand daddy)

  Something about launch or cycle
  - https://github.com/szymonkaliski/Dotfiles/blob/b5a640336efc9fde1e8048c2894529427746076f/Dotfiles/hammerspoon/init.lua#L442-L485

--]]

--[ Huzzah - we're ready! ]----------------------------------------------------
fancyNotify(&quot;Hammertime&quot;,&quot;Captain Hammer!&quot;)
</code></pre>
<h1>Download</h1>
<p>My configuration for Karabiner-Elements, Hammerspoon and other utilities can be downloaded from <a href="https://github.com/sduff/dotfiles">my github config repository</a>.</p>
<h1>References</h1>
<ul>
<li>More <a href="https://github.com/Hammerspoon/hammerspoon/wiki/Sample-Configurations">Hammerspoon sample configurations</a></li>
<li><a href="http://stevelosh.com/blog/2012/10/a-modern-space-cadet/">A Modern Space Cadet</a> An excellent writeup of one user's extensive custom configuration</li>
</ul>

<script>hljs.highlightAll();</script>
</body>
</html>
